!function(e,t){"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?module.exports=t():e.lsbridge=t()}(this,function(){var e={};if(e.isLSAvailable=function(){try{return localStorage.setItem("_","_"),localStorage.removeItem("_"),!0}catch(e){return!1}}(),e.isLSAvailable){var t=localStorage,r={},o=!1,n={},i=function(){for(var e in r){var o=t.getItem(e);if(o&&n[e]&&-1===n[e].indexOf(o)){n[e].push(o);try{var u=JSON.parse(o);u&&(o=u)}catch(e){}for(var f=0;f<r[e].length;f++)r[e][f](o);t.getItem(e+"-removeit")||(t.setItem(e+"-removeit","1"),function(r){setTimeout(function(){t.removeItem(r),t.removeItem(r+"-removeit"),n[e]=[]},200)}(e))}else o||(n[e]=[])}return setTimeout(i,100),!0};e.send=function(e,r){var o="";"function"==typeof r&&(r=r()),o="object"==typeof r?JSON.stringify(r):r,t.setItem(e,o)},e.subscribe=function(e,t){r[e]||(r[e]=[],n[e]=[]),r[e].push(t),o||(o=i())},e.unsubscribe=function(e){r[e]&&(r[e]=[]),n[e]&&(n[e]=[])},e.getBuffer=function(){return n}}else e.send=e.subscribe=function(){throw new Error("localStorage not supported.")};return e});